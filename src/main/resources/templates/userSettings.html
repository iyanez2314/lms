<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Profile Settings</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Space Mono', monospace;
        }
    </style>
</head>
<body class="bg-gray-100">
<nav th:replace="partials/navbar :: navbar(isAuthenticated=${#authentication.principal != 'anonymousUser'})"></nav>
<div class="container mx-auto px-4 py-6 flex flex-wrap justify-center">
    <div class="w-full lg:w-2/3 xl:w-1/2 bg-white rounded-lg shadow-md p-6">
        <h1 class="text-2xl font-bold mb-4">Profile Settings</h1>
        <div id="profile-picture" class="cursor-pointer w-24 h-24 rounded-full overflow-hidden my-6">
            <img th:src="${usersImage}" alt="Profile Picture" class="w-24 h-24 object-cover rounded-full"/>
        </div>
        <form th:action="@{/settings}" th:method="post" th:object="${user}">
            <label class="block mb-2" for="email">Email</label>
            <input id="email" name="email" th:field="*{email}" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-300 mb-4">
            <label class="block mb-2" for="password">New Password</label>
            <input id="password" name="password" type="password" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-300 mb-4">
            <input type="submit" value="Update" class="bg-green-500 text-white px-4 py-2 rounded cursor-pointer">
        </form>

        <form th:action="@{/settings/languages}" th:method="post">
            <h2 class="text-lg font-bold mb-4 mt-8">Programming Languages</h2>
            <div class="grid grid-cols-2 gap-4">
                <div th:each="language : ${allProgrammingLanguages}">
                    <input type="checkbox" th:id="${'language-' + language.language_id}" th:name="selectedLanguageIds" th:value="${language.language_id}" class="mr-2">
                    <label th:for="${'language-' + language.language_id}" th:text="${language.language_name}"></label>
                </div>
            </div>
            <input type="submit" value="Save Languages" class="bg-green-500 text-white px-4 py-2 rounded cursor-pointer mt-8">
        </form>
    </div>
</div>
<script src="https://static.filestackapi.com/filestack-js/3.x.x/filestack.min.js"></script>
<script>
    const videoElem = document.getElementById("profile-picture");
    const client = filestack.init("AhmkLILcZQLGXSg430xAhz");

    videoElem.addEventListener("click", () => {
        client.picker({
            onUploadDone: (res) => {
                console.log(res);
                postUpdatedPicture(res);
            },
        }).open();
    });

    function postUpdatedPicture(res){
        const profilePicUrl = res.filesUploaded[0].url;
        // TODO: I need the logged in users id, once I have that information I need to make a post request to an API and update the users pfp.
    }


</script>
</body>
</html>
